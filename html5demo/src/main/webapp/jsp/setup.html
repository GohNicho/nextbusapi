<!DOCTYPE html>
<html>
    <head>
        <title>JQuery Mobile Setup</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
        <link rel="stylesheet" href="http://localhost:8080/html5poc/css/html5demo.css" type="text/css"/>
        <style>
            label, input {
                text-align: center;
            }
        </style>
        <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
        <script>
            // 
            function getLocation(position) {
                document.getElementById('latbox').value = position.coords.latitude;
                document.getElementById('longbox').value = position.coords.longitude;
                if (position.coords.accuracy < 1.0) {
                    document.getElementById('warnings').innerHTML = 'Low GPS Accuracy -  ' + position.coords.accuracy + ' kilometers!';
                }
            }
            // Deal with GPS subsystem errors
            function geolocationErrorHandler(error) {
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        document.getElementById('warnings').innerHTML = 'GPS Permission Denied. ';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        document.getElementById('warnings').innerHTML = 'GPS Position Report Unavailable.';
                        break;
                    case error.TIMEOUT:
                        document.getElementById('warnings').innerHTML = 'GPS Position Request Timeout.';
                        break;
                }
            }
            
            function gpsinit() {
                $('#warnings').data('foo');
               // if ("geolocation" in navigator) {
               //     document.getElementById('warnings').innerHTML = 'Warning: Browser does not support HTML 5 Geolocation feature.';
               // } else {
               //     document.getElementById('enabled').innerHTML = 'Browser Geolocation feature not present.';
               //     document.getElementById('getPositionButton').disabled = true;
               // }
            }
            
            
            // Detect and initialize the GPS Feature
            $(document).delegate('.ui-page', 'pageshow', function () {
                gpsinit();
                
                // getPositionButton: Register Handler. Get the current GPS location
            $('#getPositionButton').click(function(e) {
                console.log('click getPositionButton.'+e);
                navigator.geolocation.getCurrentPosition(getLocation, geolocationErrorHandler);
            });
                
            });
        </script>
    </head>
    <body>
        <div data-role="page">
            <header data-role="header">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#location-control" data-icon="home" class="ui-btn-active">Location</a></li>
                        <li><a href="#event-feed" data-icon="home">Events</a></li>
                        <li><a href="#project-info" data-icon="home">Info</a></li>
                    </ul>
                    <div id="warnings">None.</div>
                </div>
            </header>
            <section data-role="section">
                <div  id="location-control" class="ui-grid-a">
                    <button id="getPositionButton" type="button">Update Current Location</button>
                    <form class="origin"  method="post" action="foo">
                        <fieldset class="ui-grid-a">
                            <div class="ui-block-a">
                                <input type="number" data-mini="true" id="latitude" name="latitude" required min="-90" max="90" step="0.00001" value="11.121319"/>
                                <label for="latitude">latitude (&deg;N)</label>
                            </div><div class="ui-block-b">
                                <input type="number" data-mini="true" id="longitude" name="longitude" required min="-180" max="180" step="0.00001" value="-71.23145"/>
                                <label for="longitude">longitude (&deg;W)</label>
                            </div>
                        </fieldset>
                        <h3 style="text-align: center;">Range of Interest</h3>
                        <fieldset class="ui-grid-a">
                            <div class="ui-block-a"> 
                                <input type="number" data-mini="true" id="range" name="range" min="0.1" max="5" required value="1.0" />
                            </div><div class="ui-block-b">
                                <select name="units" data-mini="true" id="units">
                                    <option value="kilometers">km</option>
                                    <option value="miles" selected>mi</option>
                                </select>
                            </div>
                        </fieldset>
                        <input type="button" name="command" value="Subscribe To Feed"/>
                    </form>
                </div>
            </section>
            <footer data-role="footer">
            </footer>
        </div>
    </body>
</html>
